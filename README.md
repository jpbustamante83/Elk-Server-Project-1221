## ELK Stack Project

The files in this repository were used to configure the network depicted below.

![image](https://user-images.githubusercontent.com/25359606/146556850-aa919271-14d9-41ec-940f-1eedfc9d5947.png)


These files have been tested and used to generate a live ELK deployment on Azure. They can be used to either recreate the entire deployment pictured above. Alternatively, select portions of the ansible file may be used to install only certain pieces of it, such as Filebeat.

[ELK Playbook](Files/Install-Elk.yml)

### Description of the Topology

The main purpose of this network is to expose a load-balanced and monitored instance of DVWA (Damn Vulnerable Web Application).

Load balancing ensures that the application will be highly available, in addition to restricting access to the network.

-What aspect of security do load balancers protect? What is the advantage of a jump box?

-Load balancers protect systems of Denial of Service attacks by shifting attack traffic.  
The is a unique point of a load balancer in that it will allow other traffic through making it available whereas it locks down the system from DDoS by shifting that traffic.
    
-A Jump-box is almost similar to a gateway router and is exposed to the public internet.  However, it sits in front of machines that are NOT exposed to the public internet and therefore controls access to the other machines by allowing connections from specific IP addresses and forwarding to those aforementioned machines.  However, there are still ways to increase security architecture for jump-boxes such as limiting the number of machines that can access it, locking the root account/limiting sudo, implementing MFA,, implementing a host firewall like UFW, and using a VPN.

Integrating an ELK server allows users to easily monitor the vulnerable VMs for changes to the logs and system traffic.

-What does Filebeat watch for? 

Filebeat is built to collect data about specific files on remote machines such as logs generated by Apache, Microsoft Azure, Nginx or MySQL databases.

-What does Metricbeat record? 

It takes the metrics and stats that it collects and puts them to the output that you specify, in our case Elasticsearch or Logstash.  These monitor servers by collecting metrics from the system and services running on the server.

The configuration details of each machine may be found below.


| Name     | Function | IP Address | Operating System |
|----------|----------|------------|------------------|
| Jump Box | Gateway  | 10.0.0.4   | Linux            |
| Web-1    | Server   | 10.0.0.5   | Linux            |
| Web-2    | Server   | 10.0.0.6   | Linux            |
| ELK-SVR  | Server   | 10.1.0.4   | Linux            |

### Access Policies

The machines on the internal network are not exposed to the public Internet. 

Only the jump box machine can accept connections from the Internet. Access to this machine is only allowed from the following IP addresses:
-Add whitelisted IP addresses: Since the jump-box public ip changes whenever the VM is powered on/off, this ip address changes, however it would be the jump-boxes public IP that would be whitelisted whenever it is logged into.

Machines within the network can only be accessed by SSH.

-Which machine did you allow to access your ELK VM? What was its IP address?_

A summary of the access policies in place can be found in the table below.

| Name     | Publicly Accessible | Allowed IP Addresses |
|----------|---------------------|----------------------|
| Jump Box | Yes                 | Public IP (changes when powered off/on)|
| Web-1    | No                  | 10.0.0.5             |
| Web-2    | No                  | 10.0.0.6             |
| ELK-Svr  | No                  | 10.1.0.4             |

### Elk Configuration

Ansible was used to automate configuration of the ELK machine. No configuration was performed manually, which is advantageous because its much easier to do and prevented overlooking vulnerabilities.

-What is the main advantage of automating configuration with Ansible?

[Ansible Configuration](Files/ansible.cfg)

Ansible automation helps considerably with the representation of Infrastructure as Code (IAC). IAC involves provisioning and management of computing infrastructure and related configuration through machine-processable definition files.

The playbook implements the following tasks:
Install docker.io
Install python3-pip
Install docker via pip
Increase vitual memory
Use more memory

[Docker Container](https://github.com/jpbustamante83/Elk-Server-Project-1221/blob/main/Pics/docker%20container.png)

Download and launch a docker elk container - starts docker and establishes the ports being used.

[Docker Start/Attach](https://github.com/jpbustamante83/Elk-Server-Project-1221/blob/main/Pics/docker%20start%20attach.png)


The following screenshot displays the result of running `docker ps` after successfully configuring the ELK instance.

[Docker PS](https://github.com/jpbustamante83/Elk-Server-Project-1221/blob/main/Pics/docker%20ps.png)


### Target Machines & Beats
This ELK server is configured to monitor the following machines:

[Hosts File](Files/hosts)

Web-1 10.0.0.5

Web-2 10.0.0.6

We have installed the following Beats on these machines:

[Filebeat Configuration](Files/filebeat-config.yml)

[Filebeat Playbook](Files/filebeat-playbook.yml)

[Metricbeat Configuration](Files/metricbeat-config.yml)

[Metricbeat Playbook](Files/metricbeat-playbook.yml)

These Beats allow us to collect the following information from each machine:

-Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing

-Metricbeat periodically collect metrics from the operating system and from services running on the server.

### Using the Playbook
In order to use the playbook, you will need to have an Ansible control node already configured. Assuming you have such a control node provisioned: 

SSH into the control node and follow the steps below:

-Copy the configuration and playbook YAML files, to the /etc/ansible/files folder using:
 
 cp ./Resources/filebeat-config.yml /etc/ansible/files/filebeat-config.yml 
  
 cp ./Resources/filebeat-play.yml /etc/ansible/files/filebeat-play.yml 
  
 cp ./Resources/metricbeat-config.yml /etc/ansible/files/metricbeat-config.yml 
  
 cp ./Resources/metricbeat-play.yml /etc/ansible/files/metricbeat-play.yml 
  
 cp ./Resources/install-ELK.yml /etc/ansible/files/install-ELK.yml
  
-Update the filebeat-config and metricbeat-config files each to point towards the ELK server IP address, username and password. 
  
 (10.1.0.4, elastic & changeme, respectively, for both config files)
  
-Update the /etc/ansible/hosts file with two separate sections for the private server IP addresses of the ELK server and the webservers on the internal network. 
  
 (see above for IP addresses) configure two sections: [webservers] [elkservers]

-Run the filebeat and metricbeat playbooks, and ssh into each webserver (10.0.0.4, 10.0.0.5, and 10.0.0.6, respectively) 
 
 and run "curl localhost/setup.php" to verify installation worked.
 
 enter: ssh azureuser@server-ip-address (replace "server-ip-address" with above IP addresses
 
-You should get an HTML code response on-screen. Next, navigate to the webservers via the load balancer's public IP address 
 
 (*changes on every startup*/setup.php) to check that the installation worked as expected.
 
-Run the install-ELK playbook and navigate to the ELK server's Kibana webpage using the ELK server's public IP address at the following URL 

(http://111.111.111.111/app/kibana#/home) to check that the installation worked as expected. You should see the Kibana homepage. 

(Be sure to put your public IP address in place of the 111.111.111.111)


